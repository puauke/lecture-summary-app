# 🔒 セキュリティ対策チェックリスト

## ✅ 実装済みの対策

### 1. **ファイルアップロード検証** (file_loader.py)
- ✅ 拡張子の厳密なチェック（.pdf / .txt のみ）
- ✅ ファイルサイズ制限（5MB）
- ✅ ファイル名のサニタイゼーション（危険な文字を除去）
- ✅ パストラバーサル攻撃対策
- ✅ エラーハンドリング強化

### 2. **URL・Web検索セキュリティ** (web_loader.py)
- ✅ SSRF（Server-Side Request Forgery）対策
  - localhost, 127.0.0.1, 192.168.x.x へのアクセス禁止
  - AWS メタデータサーバー（169.254.169.254）へのアクセス禁止
  - プライベート IP レンジを全てブロック
- ✅ 検索クエリのサニタイゼーション
- ✅ タイムアウト設定（10秒）
- ✅ コンテンツサイズ制限（2MB）
- ✅ RSS フィード検証
- ✅ HTTPS の推奨

### 3. **入力値検証・エスケープ** (全般)
- ✅ APIキーの長さ検証
- ✅ エラーメッセージの情報漏洩防止
- ✅ XSS 対策（Streamlit の自動エスケープ）
- ✅ インジェクション攻撃対策

### 4. **依存ライブラリ管理** (requirements.txt)
- ✅ バージョンロック（セキュリティ脆弱性対策）
- ✅ 定期的な更新推奨

### 5. **機密情報保護** (.gitignore)
- ✅ .env ファイルの除外
- ✅ API キーの除外
- ✅ 個人情報の除外
- ✅ データベースファイルの除外

---

## 📋 使用時の注意点

### APIキー管理
```
# 推奨: 環境変数で管理
export GOOGLE_API_KEY=your_key_here

# または .env ファイル（.gitignore に含める！）
GOOGLE_API_KEY=your_key_here
```

### ファイルアップロード
- ✅ PDF / TXT のみアップロード可能
- ✅ 5MB 以上のファイルは自動で制限
- ✅ 不正な拡張子は自動拒否

### Web データ取得
- ✅ 信頼できるサイトのみアクセス
- ✅ ローカル IP / 内部ネットワークへのアクセス禁止
- ✅ 大規模コンテンツは自動で制限

---

## 🔄 定期的にチェックすべき項目

```bash
# 依存ライブラリの脆弱性スキャン
pip install safety
safety check

# 定期的な更新
pip list --outdated
pip install --upgrade [package-name]==X.Y.Z
```

---

## ⚠️ 本番環境での追加対策

デプロイ時に以下も検討してください：

1. **HTTPS 強制** - Streamlit Cloud は自動対応
2. **レート制限** - API 呼び出し数の制限
3. **ログ監視** - 不正なアクセスパターン検出
4. **バックアップ** - 定期的なデータバックアップ
5. **インシデント対応計画** - セキュリティ侵害時の対応

---

## 🚀 デプロイ前チェックリスト

- [ ] API キーが .gitignore に含まれている
- [ ] .env ファイルが GitIgnored されている
- [ ] 最新の依存ライブラリがインストールされている
- [ ] 全テストが成功している
- [ ] エラーメッセージに機密情報が含まれていない
- [ ] URL バリデーションが有効
- [ ] ファイルアップロード検証が有効

---

**最後に：完全な安全性は保証できません。** 
このアプリはセキュリティベストプラクティスに従っていますが、定期的な監視と更新が重要です。
